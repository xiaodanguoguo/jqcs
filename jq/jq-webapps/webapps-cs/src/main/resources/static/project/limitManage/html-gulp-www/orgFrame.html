<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>酒钢客户服务平台</title>
	<link rel="icon" href   ="../../../logocon.png">
	<link rel="stylesheet" href="../../../base/css/baseBlue.css">
	<link rel="stylesheet" href="../../../base/iconfont/iconfont.css">
	<link rel="stylesheet" href="../../commonNav/css/commonHeaderBlue.css">
	<script src="../../../base/js/jquery.js"></script>
	<script src="../../../base/js/public.js"></script>
	<script src="../../../base/js/docassistant.js" ></script>
	<script src="../../../base/js/validate.js"></script>
	<script src="../../../base/js/jquery.media.js"></script>
	<script src="../../../base/js/jquery.cookie.js"></script>
	<script src='../../../titleName.js'></script>
	<script src="../../../reqConfig.js"></script>
	<!--！！！！！！
		组件js
	！！！！！！！-->
	<script type="text/javascript" src="../../../base/js/ajaxupload.js"></script>
	<!--时间插件-->
	<link rel="stylesheet" href="../../../plugin/WdatePickerBlue/My97DatePicker/skin/messageWdatePicker.css">
	<script src="../../../plugin/WdatePickerBlue/My97DatePicker/WdatePicker.js"></script>
	<!--弹框插件-->
	<link rel="stylesheet" href="../../../plugin/popup/css/manhuaDialog.1.0_blue.css">
	<script src="../../../plugin/popup/script/manhuaDialog.1.0.js"></script>
	<!--提示校验-->
	<link rel="stylesheet" href="../../../plugin/tip/css/tip-twitter/tip-twitter.css">
	<script src="../../../plugin/tip/script/jquery.poshytip.js"></script>
	<!--滑动校验-->
	<link rel="stylesheet" href="../../../plugin/dragValidate/css/drag.css">
	<script src="../../../plugin/dragValidate/js/drag.js"></script>
	<!--分页-->
	<link rel="stylesheet" href="../../../plugin/page/css/table.css">
	<script type="text/javascript" src="../../../plugin/page/script/jquery.page.js"></script>
	<!--下拉选择-->
	<link rel="stylesheet" href="../../../plugin/select/chosen_blue.css">
	<script src="../../../plugin/select/chosen.jquery.js"></script>
	<script>


        //在页面未加载完毕之前显示的loading Html自定义内容

        var _LoadingHtml = '<span id="loadingDiv" style="width:100%;height: '+ (document.documentElement.clientHeight  + 200) +'px;display: block;background: #fff;text-align: center;line-height: '+ (document.documentElement.clientHeight  + 200) +';">页面加载中，请等待...</span>';

        //呈现loading效果

        document.write(_LoadingHtml);

        //监听加载状态改变
        document.onreadystatechange = completeLoading;

        //加载状态为complete时移除loading效果
        function completeLoading() {
            if (document.readyState == "complete") {
                var loadingMask = document.getElementById('loadingDiv');
                loadingMask.parentNode.removeChild(loadingMask);
            }
        }





        var date_start;
        var i=0;
		$(function(){
            $("#userName").html(unescape(getCookie("userName")));
            $(".og-head-mainlt__sidebar .og-head-mainlt__sasety").removeClass("og-head-mainlt__sidebar--shrinkActive");
            if(unescape(getCookie("navListIdx"))){
                $(".og-head-mainlt__sasety").each(function () {
					if(unescape(getCookie("navListIdx")) == $(this).val()){
					    $(this).addClass("og-head-mainlt__sidebar--shrinkActive")
					}
                });
                //$(".og-head-mainlt__sasety").eq(unescape(getCookie("navListIdx"))).addClass("og-head-mainlt__sidebar--shrinkActive");
            }
		    //导航的点击
		    $(".og-head-navlist li a").on("click",function(){
                $(".og-head-navlist li a").removeClass("og-head-navlist____linkActive");
		        $(this).addClass("og-head-navlist____linkActive")
                $(".og-head-mainlt__sidebar").css("display","none");
		        $(".og-head-mainlt__sidebar").eq($(this).parents(".og-head-navlist__item").index()).css("display","")
			})
			//左侧的点击事件
			$("#js-leftNavBar .og-head-mainlt__sasety").on("click",function(){
                $(".og-head-mainlt__sidebar .og-head-mainlt__sasety").removeClass("og-head-mainlt__sidebar--shrinkActive");
			    $(this).addClass("og-head-mainlt__sidebar--shrinkActive");
			    setCookie("navListIdx",escape($(this).val()));
			    window.location.href=$(this).find("a").attr("acSrc")
				//$(this).parents(".og-head-mainlt__sidebar--menu").find("ul").css("display","");
			})
            //点击退出
            $("#quitBtn").on("click",function(){
                getAjaxResult("/acct/remSession","post",{},"quitFun(data)");

            })
			$("#editPassword").on("click",function(){
			    jumpUrl("../../login/html-gulp-www/passwordNew.html","0000000",0);
			});
            $("#logo").on("click",function () {
                clearCookie("navListIdx");
                jumpUrl("../../homePage/html-gulp-www/homePage.html","0000000",0)
            });
            $("#downLoadShouCe").on("click",function(){
                var importParam = "name=";
                $.download(requestUrl + "/millsheet/downOperationManual", importParam, "POST");
			});
            start();
            //赋值内容主体高度，显示footer
			if($("#js-leftNavBar").height() > $("#js-loader").height()){
			    $(".og-head-main").css("height",$("#js-leftNavBar").height()+"px");
			}else{
                $(".og-head-main").css("height",$("#js-loader").height()+"px");
			}
			//在线人数
			getAjaxResult("/acct/getLoginCount","POST",{},"personNumCallBack(data)");
		})

		function personNumCallBack(data) {
			data = JSON.parse(data);
			if(data.retCode == "0000000"){
			    if(data.rspBody){
			    	$("#personNum").html(data.rspBody);
				}
			};
        }
        //退出接口
        function quitFun(data){
            var jsData=JSON.parse(data);
            if(jsData.retCode=="0000000"){
                clearCookie("userName");
                clearCookie("navListIdx");
                clearCookie("isLogin")
                if(window.Storage && window.localStorage && window.localStorage instanceof Storage){
                    window.localStorage.limitCode = [];
                }else{
                    setCookie("limitCode",escape(JSON.stringify([])));
                }
                jumpUrl("../../../login.html","0000000",0);
            }else{
                alert(jsData.retDesc)
            }
        }
        function start(){
            date_start=new Date();  //开始时间
            start_time();
        }
        function start_time(){

            set= window.setTimeout("start_time()", 1000);
            var date_end= new Date(); //结束时间
            var date_sum = date_end.getTime() - new Date(date_start).getTime(); //结束时间-开始时间
            //天数
            var days=Math.floor(date_sum/(24*60*60*1000))
            //小时数
            var day_ms=date_sum%(24*60*60*1000)    //计算天数后剩余的毫秒数
            var hours=Math.floor(day_ms/(60*60*1000))
            //分钟数
            var day_hour=day_ms%(60*60*1000)        //计算小时数后剩余的毫秒数
            var minutes=Math.floor(day_hour/(60*1000))
            //秒数
            var day_min=day_hour%(60*1000)      //计算分钟数后剩余的毫秒数
            var seconds=Math.round(day_min/1000)
            //getMonth 方法返回一个0到11之间的整数，是Date对象中的月份值，并不是现实中的月份值，要加+1才是。
            //开始运行时间
            document.getElementById("now_time").innerHTML=
                ""+date_end.getFullYear()+"年"
                +(date_end.getMonth()+1)+"月"+date_end.getDate()+"日"
                +date_end.getHours()+"时"+date_end.getMinutes()+"分"
                +date_end.getSeconds()+"秒"
		}
	</script>
</head>
<body style="position: relative;">
	<div class="og-head">
		<div class="og-head-nav">
	        <div class="og-head-navwrap">
	            <div class="og-head-navlogo" id="logo">
	                <a href="javascript:;" class="og-head-navlogo__logoimg"></a>
	            </div>
				<div class="og-head-navwrap-opeBox clearfix fr">
					<!--
					<span class="og-head-navwrap-opeBoxList">
						<div class="og-head-navwrap-opeBoxListImg fl" style="background-image: url('../images/4.png')"></div>
						<span class="fl">公告</span>
					</span>
					<span class="og-head-navwrap-opeBoxList">
						<div class="og-head-navwrap-opeBoxListImg fl" style="background-image: url('../images/3.png')"></div>
						<span class="fl">代办</span>
					</span>-->
					<span class="og-head-navwrap-opeBoxList" id="downLoadShouCe" style="cursor: pointer">
						<div class="og-head-navwrap-opeBoxListImg fl" style="background-image: url('../../commonNav/images/xiazia.png')"></div>
						<span class="fl">下载手册</span>
					</span>
					<span class="og-head-navwrap-opeBoxList" id="quitBtn" style="cursor: pointer">
						<div class="og-head-navwrap-opeBoxListImg fl" style="background-image: url('../../commonNav/images/tc.png')"></div>
						<span  class="fl">退出</span>
					</span>
					<span class="og-head-navwrap-opeBoxList" id="editPassword" style="cursor: pointer">
						<div class="og-head-navwrap-opeBoxListImg fl" style="background-image: url('../../commonNav/images/xgmm.png')"></div>
						<span class="fl">修改密码</span>
					</span>
				</div>
	            <div class="og-head-navwrap-box clearfix fr">
					<span class="og-head-navwrap-boxList" style="width: 270px!important;">您好，<span id="userName"></span></span>

					<span class="fl" style="margin-left: 0px;">在线人数：
						<span id="personNum">0</span>人
					</span>
					<p id="now_time" class="og-head-navwrap-boxList" style="width: 220px;"></p>
				</div>
	        </div>
	    </div>
	   	<div class="og-head-main clearfix">
	    	<div class="og-head-mainlt og-head-mainlt__homepaActive" id="js-leftNavBar">
	    		<!--<div class="og-head-mainlt__homepa">
	    			权限管理
	    		</div>-->
	    		<ul class="og-head-mainlt__sidebar">
	    			<li class="og-head-mainlt__sidebar--menu" limitCode="M5">
	    				<a class="og-head-mainlt__sidebar--shrink " href="javascript:;"><i class="arrow-up"></i><span class="arrow-span">系统管理</span></a>
						<ul class="menu-ul">
							<li class="og-head-mainlt__sasety" limitCode="M505" value="0"><a href="javascript:;" href="javascript:;" acSrc="../../limitManage/html-gulp-www/accountAudit.html">账号审核</a></li>
							<li class="og-head-mainlt__sasety" limitCode="M501" value="1"><a href="javascript:;" href="javascript:;" acSrc="../../limitManage/html-gulp-www/orgFrame.html">组织管理</a></li>
							<li class="og-head-mainlt__sasety" limitCode="M503" value="2"><a href="javascript:;" href="javascript:;" acSrc="../../limitManage/html-gulp-www/roleManage.html">角色管理</a></li>
							<li class="og-head-mainlt__sasety" limitCode="M504" value="3"><a href="javascript:;" href="javascript:;" acSrc="../../limitManage/html-gulp-www/resourceManage.html">资源管理</a></li>
							<li class="og-head-mainlt__sasety" limitCode="M502" value="4"><a href="javascript:;" href="javascript:;" acSrc="../../limitManage/html-gulp-www/userManage.html">人员管理</a></li>
							<li class="og-head-mainlt__sasety" limitCode="M506" value="21"><a href="javascript:;" href="javascript:;" acSrc="../../limitManage/html-gulp-www/userAnalyse.html">用户行为分析</a></li>
							<li class="og-head-mainlt__sasety" limitCode="M104" value="5"><a href="javascript:;" href="javascript:;" acSrc="../../limitManage/html-gulp-www/annListPreserve.html">发布公告</a></li>
						</ul>
	    			</li>
					<li class="og-head-mainlt__sidebar--menu" limitCode="M2">
						<a class="og-head-mainlt__sidebar--shrink " href="javascript:;"><i class="arrow-up"></i><span class="arrow-span">质量证明书</span></a>
						<ul class="menu-ul">
							<li class="og-head-mainlt__sasety" limitCode="M201" value="6"><a href="javascript:;" href="javascript:;" acSrc="../../quality/html-gulp-www/checkTrue.html">防伪验真</a></li>
							<li class="og-head-mainlt__sasety" limitCode="M202" value="7"><a href="javascript:;" href="javascript:;" acSrc="../../quality/html-gulp-www/qualityBookList.html">质证书管理</a></li>
							<li class="og-head-mainlt__sasety" limitCode="M204" value="19"><a href="javascript:;" href="javascript:;" acSrc="../../quality/html-gulp-www/qualityBookList2.html">质证书管理(酒钢)</a></li>
							<!--<li class="og-head-mainlt__sasety" limitCode="M203" value="8"><a href="javascript:;" href="javascript:;" acSrc="../../quality/html-gulp-www/applyBack.html">申请回退</a></li>-->
						</ul>
					</li>
					<li class="og-head-mainlt__sidebar--menu"  limitCode="M3">
						<a class="og-head-mainlt__sidebar--shrink " href="javascript:;"><i class="arrow-up"></i><span class="arrow-span">产品诉赔</span></a>
						<ul class="menu-ul">
							<li class="og-head-mainlt__sasety" limitCode="M301" value="9"><a href="javascript:;" href="javascript:;" acSrc="../../appealCompensate/html-gulp-www/personManage.html">管理联系信息</a></li>
							<li class="og-head-mainlt__sasety" limitCode="M302" value="10"><a href="javascript:;" href="javascript:;" acSrc="../../appealCompensate/html-gulp-www/objectionSubmit.html">异议提报</a></li>
							<li class="og-head-mainlt__sasety" limitCode="M303" value="11"><a href="javascript:;" href="javascript:;" acSrc="../../appealCompensate/html-gulp-www/objectionReasearch.html">异议调查</a></li>
							<li class="og-head-mainlt__sasety" limitCode="M304" value="12"><a href="javascript:;" href="javascript:;" acSrc="../../appealCompensate/html-gulp-www/objectionDeal.html">异议处理</a></li>
							<li class="og-head-mainlt__sasety" limitCode="M305" value="13"><a href="javascript:;" href="javascript:;" acSrc="../../appealCompensate/html-gulp-www/objectionFinish.html">异议结案</a></li>
							<li class="og-head-mainlt__sasety" limitCode="M306" value="20"><a href="javascript:;" href="javascript:;" acSrc="../../appealCompensate/html-gulp-www/objectionStatic.html">质量异议统计台账</a></li>
						</ul>
					</li>
					<li class="og-head-mainlt__sidebar--menu" limitCode="M1">
						<a class="og-head-mainlt__sidebar--shrink " href="javascript:;"><i class="arrow-up"></i><span class="arrow-span">问卷调查</span></a>
						<ul class="menu-ul">
							<li class="og-head-mainlt__sasety" limitCode="M101" value="14"><a href="javascript:;" href="javascript:;" acSrc="../../myBussiness/html-gulp-www/questionList.html">创建调查问卷</a></li>
							<li class="og-head-mainlt__sasety" limitCode="M103" value="15"><a href="javascript:;" href="javascript:;" acSrc="../../myBussiness/html-gulp-www/questionStatic.html">问卷调查统计</a></li>
							<li class="og-head-mainlt__sasety" limitCode="M102" value="16"><a href="javascript:;" href="javascript:;" acSrc="../../myBussiness/html-gulp-www/questionWrite.html">请填写调查问卷</a></li>
						</ul>
					</li>
					<li class="og-head-mainlt__sidebar--menu"  limitCode="M4">
						<a class="og-head-mainlt__sidebar--shrink " href="javascript:;"><i class="arrow-up"></i><span class="arrow-span">产品推荐</span></a>
						<ul class="menu-ul">
							<li class="og-head-mainlt__sasety" limitCode="M401" value="17"><a href="javascript:;" href="javascript:;" acSrc="../../recommond/html-gulp-www/productNewsList.html">产品推荐信息维护</a></li>
							<li class="og-head-mainlt__sasety" limitCode="M402"  value="18"><a href="javascript:;" href="javascript:;" acSrc="../../recommond/html-gulp-www/proTypeList.html">产品展示</a></li>
							<!--<li class="og-head-mainlt__sasety" limitCode=""><a href="javascript:;" href="javascript:;" acSrc="../../recommond/html-gulp-www/productNewsList.html">按用途分类</a></li>-->
						</ul>
					</li>
	    		</ul>
	    	</div>
	    	<div id="js-loader" class="og-head-maincontent">

<link rel="stylesheet" href="../css/resourchAd.css">
<link rel="stylesheet" href="../../../plugin/treeview/jquery.treeview.css" />
<link rel="stylesheet" href="../../../plugin/treeview/screen.css" />
<script src="../../../plugin/treeview/lib/jquery.cookie.js" type="text/javascript"></script>
<script src="../../../plugin/treeview/jquery.treeview.js" type="text/javascript"></script>
<script src="../js/deletePage.js"></script>
<style>
    .chosen-container{
        width:157px !important;
        margin-left:0px !important;
    }
    #addReInpDiv .chosen-container{
        margin-top: 2px;
    }
</style>
<script>
    var orgNameJumpUser = "";
    var orgNameId = "";
    var orgNameParentId = "";
    function tissueAdmin(){
        this.init=tissueInit;
        this.incident=tissueIncident;
        this.vali=new clsValidateCtrl();
        this.rank=null;
        this.alertBox=new clsAlertBoxCtrl();
        this.sure=null;
        this.newCom=null;
        this.onThis=null;
        this.idC=null;
        this.orgId=null;
    }
    function tissueInit(){
        //this.vali=;
        //初始化调用的方法
        //select
        $($("select")).chosen({
            //disable_search_threshold: 5,
            no_results_text: "没有匹配结果!",
            enable_split_word_search: false,
            placeholder_text_single: '请选择'
        });
        // /getListTreeOrgInfo
        this.orgId=$.cookie('orgId');
        var acctType=$.cookie('acctType');
        if(acctType==0){
            $(".left-div-two").css("display","");
        }
        if(this.orgId.length==11){
            $('.resourceOrg').css("display","")
        }else{
            getAjaxResult("/orgInfo/getChildTreeOrgInfo","POST",{"parentId":this.orgId},"orgInfo(data)")
            $("#navigation").find("a").attr("href","javascript:;")
            this.incident();
        }
    }
    function tissueIncident(){
        var _this=this;
        //点击添加客户调用的接口
        $("#addTissue").on("click",function(){
            openWin('350', '450', 'inputAnswer', true);
            $("#addReInpDiv #addReInp").attr("disabled",true);
            $("#addReInp").val("");
            initValidate($("#addReInpDiv")[0]);
            _this.newCom=0;
            _this.rank=1;
        })
        //添加客户点击保存调用的接口
        $("#addRe").on("click",function(){
            if(!_this.vali.validateAll4Ctrl()){
                return false;
            }
            var json={};
            switch(_this.rank){
                case 1:json.parentId=document.body.docT.orgId;break;
                case 2:json.parentId=$("#fotTable")[0].jsonData.id;break;
                case 3:json.parentId=$("#fotTable")[0].jsonData.id;break;
            }
            json.orgName=$("#addReInp").val();
            json.remark=$("#memoInp").val();
            json.orgType=$("#inputAnswer #orgType").val();
            json.sapCode=$("#inputAnswer #sapCode").val();
            json.tel=$("#inputAnswer #tel").val();
            json.addr=$("#inputAnswer #addr").val();
            json.bukrs=$("#inputAnswer #bukrs").val();
            if($("#industrialCode").is(":checked")){
                json.industrialCode = 1;
            }else{
                json.industrialCode = 0;
            }

            if($("#stateInp").attr("checked")){
                json.status=1;
            }else{
                json.status=0;
            }
            if(_this.newCom==1){
                json.id=json.parentId;
                json.parentId=$("#fotTable")[0].jsonData.parentId;
                getAjaxResult("/orgInfo/saveOrgInfo","POST",json,"addReAFun(data)")
            }else if(_this.newCom==0){
                getAjaxResult("/orgInfo/addOrgInfo","POST",json,"addReAFun(data)")
            }

        })
        //根目录添加点击事件
        $(".left-div-two").on("click",function(){
            _this.rank=1;
            $("#fotTable").css("display","none");
            $(".resourceAd-con-left a").css({"color":"#888888"});
            $(this).css({"color":"#6390f3"});
            //openWin('350', '200', 'inputAnswer', true);
        })
        //点击树的文字时候调用接口
        $(".resourceAd-con-left").delegate("li a","click",function(){
            $(".resourceAd-con-left a").css("color","#888888");
            $(".left-div-two").css({"color":"#888888"})
            if(document.body.jsDel.delBtn($(this).parents('li')[0].data,"children")){
                _this.rank=2;
            }else{
                _this.rank=3;
            }

            $(this).css({"color":"#6390f3"});
            orgNameJumpUser = $(this).parents('li')[0].data.orgName;
            orgNameId = $(this).parents(".collapsable:first")[0].data.orgType;
            if($(this).parents(".collapsable").length > 1){
                orgNameParentId = $(this).parents(".collapsable")[1].data.orgType;
            }else{
                orgNameParentId = $(this).parents(".collapsable")[0].data.orgType - 1;
            }
            $("#fotTable").css("display","")
            getAjaxResult("/orgInfo/getOrgInfo","post",{"id":$(this).parents('li')[0].data.id},"initTissue(data)");
        })
        //点击停用和启用的时候
        $("#fotTable #stateU").on("click",function(){
            var str=null;
            _this.sure=2;
            if(parseInt($(this).attr("status"))){
                str="启用"
            }else{
                str="停用"
            }
            $(this).parents("ul")[0].jsonData.status=$(this).attr("status");
            document.body.docT.alertBox.Alert('确定'+str,"提示",1,true);
        })
        //新建
        $("#newTiss").on("click",function(){
            _this.newCom=0;
            $("#addReInp").val("");
            $("#memoInp").val("");
            $("#inputAnswer #orgType").val("");
            $("#inputAnswer #sapCode").val("");
            $("#inputAnswer #tel").val("");
            $("#inputAnswer #addr").val("");
            $("#stateInp").attr("checked",false);
            $("#industrialCode").attr("checked",false);
            $("#inputAnswer h2").text("新增组织");
            $("#orgType").attr("initValue","").trigger('chosen:updated');
            if(_this.rank){
                openWin('350', '450', 'inputAnswer', true);
                $("#addReInpDiv #addReInp").attr("disabled",true);
            }else{
                document.body.docT.alertBox.Alert("请先选择客户","提示")
            }
            initValidate($("#addReInpDiv")[0]);
            //l-m
            var arrSelect = [{"orgTypeCode":1,"orgTypeName":"销售公司"},{"orgTypeCode":2,"orgTypeName":"一级代理"},{"orgTypeCode":3,"orgTypeName":"贸易商"},{"orgTypeCode":4,"orgTypeName":"终端用户"}];
            switch (orgNameId){
                case "1":
                    arrSelect = [{"orgTypeCode":2,"orgTypeName":"一级代理"},{"orgTypeCode":3,"orgTypeName":"贸易商"},{"orgTypeCode":4,"orgTypeName":"终端用户"}];
                    break;
                case "2":
                    arrSelect = [{"orgTypeCode":3,"orgTypeName":"贸易商"},{"orgTypeCode":4,"orgTypeName":"终端用户"}];
                    break;
                case "3":
                    arrSelect = [{"orgTypeCode":4,"orgTypeName":"终端用户"}];
                    break;
               /* case "5":
                    [{"orgTypeCode":5,"orgTypeName":"酒钢机构"}]
                    break;*/
                case "4":
                case "5":
                case "":
                    arrSelect = [];
                    break;
            }
            if(getCookie("acctType") == 0){
                arrSelect = [{"orgTypeCode":1,"orgTypeName":"销售公司"},{"orgTypeCode":2,"orgTypeName":"一级代理"},{"orgTypeCode":3,"orgTypeName":"贸易商"},{"orgTypeCode":4,"orgTypeName":"终端用户"},{"orgTypeCode":5,"orgTypeName":"酒钢机构"}];
            }
            $("#orgType").attr("initValue","");
            //initplugData($("#orgType")[0],"singleSelectCtrl",arrSelect);
            $("#orgType").attr("comType","singleSelectCtrl");
            $("#orgType")[0].data = {"rspBody":arrSelect};
            document.body.jsCtrl.ctrl = $("#orgType")[0];
            document.body.jsCtrl.init();

        })
        //删除
        $("#deleteTiss").on("click",function(){
            if(_this.rank==1){
                document.body.docT.alertBox.Alert("不可以删除根目录","提示")
            }else if(_this.rank==2){
                _this.sure=1;
                document.body.docT.alertBox.Alert("确定删除该客户","提示",1,true)
            }else if(_this.rank==3){
                document.body.docT.alertBox.Alert("不可删除该组织","提示")
            }else{
                document.body.docT.alertBox.Alert("请先选择客户","提示")
            }
        })
        //编辑
        $("#comTiss").on("click",function(){
            _this.newCom=1;
            /*if(_this.rank==1){
                document.body.docT.alertBox.Alert("不可以修改根目录","提示")
            }else if(_this.rank==2){
                openWin('350', '450', 'inputAnswer', true);
            }else{
                document.body.docT.alertBox.Alert("请先选择客户","提示")
            }*/
            if(_this.rank){
                openWin('350', '450', 'inputAnswer', true);
                $("#addReInpDiv #addReInp").attr("disabled",true);
            }else{
                document.body.docT.alertBox.Alert("请先选择客户","提示")
            }
            $("#inputAnswer h2").text("编辑客户");
            $("#addReInp").val($("#fotTable")[0].jsonData.orgName);
            $("#memoInp").val($("#fotTable")[0].jsonData.remark);
            $("#inputAnswer #orgType").val($("#fotTable")[0].jsonData.orgType);
            $("#inputAnswer #orgType").trigger("chosen:updated")
            $("#inputAnswer #sapCode").val($("#fotTable")[0].jsonData.sapCode);
            $("#inputAnswer #tel").val($("#fotTable")[0].jsonData.tel);
            $("#inputAnswer #addr").val($("#fotTable")[0].jsonData.addr);
            $("#inputAnswer #bukrs").val($("#fotTable")[0].jsonData.bukrs);
            if($("#fotTable")[0].jsonData.status=="1"){
                $("#stateInp").attr("checked",true);
            }else{
                $("#stateInp").attr("checked",false);
            }
            if($("#fotTable")[0].jsonData.industrialCode == 1){
                $("#industrialCode").attr("checked",true);
            }else{
                $("#industrialCode").attr("checked",false);
            }
            initValidate($("#addReInpDiv")[0]);

            //l-m
            var arrSelect = [{"orgTypeCode":1,"orgTypeName":"销售公司"},{"orgTypeCode":2,"orgTypeName":"一级代理"},{"orgTypeCode":3,"orgTypeName":"贸易商"},{"orgTypeCode":4,"orgTypeName":"终端用户"}];
            switch (orgNameParentId){
                case "1":
                    arrSelect = [{"orgTypeCode":2,"orgTypeName":"一级代理"},{"orgTypeCode":3,"orgTypeName":"贸易商"},{"orgTypeCode":4,"orgTypeName":"终端用户"}];
                    break;
                case "2":
                    arrSelect = [{"orgTypeCode":3,"orgTypeName":"贸易商"},{"orgTypeCode":4,"orgTypeName":"终端用户"}];
                    break;
                case "3":
                    arrSelect = [{"orgTypeCode":4,"orgTypeName":"终端用户"}];
                    break;
                /* case "5":
                     [{"orgTypeCode":5,"orgTypeName":"酒钢机构"}]
                     break;*/
                case "4":
                case "5":
                case "":
                    arrSelect = [];
                    break;
            }
            if(getCookie("acctType") == 0){
                arrSelect = [{"orgTypeCode":1,"orgTypeName":"销售公司"},{"orgTypeCode":2,"orgTypeName":"一级代理"},{"orgTypeCode":3,"orgTypeName":"贸易商"},{"orgTypeCode":4,"orgTypeName":"终端用户"},{"orgTypeCode":5,"orgTypeName":"酒钢机构"}];
            }
            $("#orgType").attr("initValue",$("#fotTable")[0].jsonData.orgType);
            //initplugData($("#orgType")[0],"singleSelectCtrl",arrSelect);
            $("#orgType").attr("comType","singleSelectCtrl");
            $("#orgType")[0].data = {"rspBody":arrSelect};
            document.body.jsCtrl.ctrl = $("#orgType")[0];
            document.body.jsCtrl.init();
        })
        //关联
        $(".relevance").on("click",function(){
            var url="";
            switch ($(this).attr("rel")){
                case "1":url="/project/limitManage/html-gulp-www/userManage.html";break;
                case "2":url="/project/limitManage/html-gulp-www/roleManage.html";break;
                case "3":url="/project/limitManage/html-gulp-www/resourceManage.html";break;
            }
            window.open(encodeURI(url+"?orgId="+$(this).parents("#fotTable")[0].jsonData.id+"&orgName="+$(this).parents("#fotTable")[0].jsonData.orgName))
        })
        $(".viewUserMange").on("click",function () {
            jumpUrl("userManage.html?orgNameJumpUser=" + escape($("#orgName").html()),"0000000",1);
        })
        $("#addReInpDiv #sapCode").on("change",function(){
            getAjaxResult("/orgInfo/getOrgName","POST",{"sapCode":$(this).val()},"orgCodeCheckCallBack(data)")
        });
    }
    //校验客户code码
    function orgCodeCheckCallBack(data){
        data = JSON.parse(data);
        if(data.retCode == "0000000"){
            if(data.rspBody.orgName != ""){
                $("#addReInpDiv #addReInp").val(data.rspBody.orgName);
            }else{
                $("#addReInpDiv #addReInp").attr("disabled",false);
            }
        }
    }
    //页面初始化调用树的接口
    function orgInfo(data){
        var jsData=JSON.parse(data);
        if(jsData.retCode=="0000000"){
            if(jsData.rspBody.children.length){
                $(".resourceAd").css("display","block")
                var tissueList = new treeCheck();
                tissueList.loopLoad(jsData.rspBody.children, $(".resourceAd-con-left"), true);
                tissueList.unionChecked("input[type=checkbox]");
                $(".resourceAd-con-left ul").attr("id","navigation");
                $(".resourceAd-con-left ul").addClass("navigation")
                $("#navigation").treeview();
            }else{
                $(".resource").css("display","block")
            }

        }else{
            var alertBox=new clsAlertBoxCtrl();
            alertBox.Alert(jsData.retDesc,"提示");
        }
    }
    //弹框点击确定之后调用的方法
    function clsAlertBoxCtrl$sure() {
        //当对象是1的时候执行的事情
        if(document.body.docT.sure==1){
            document.body.docT.sure=0;
            // $("#fotTable")[0].jsonData;
            document.body.docT.idC=$("#fotTable")[0].jsonData.parentId;
            //删除的时候调用
            getAjaxResult("/orgInfo/removeOrgInfo","post",$("#fotTable")[0].jsonData,"deleteSure(data)");
        }else if(document.body.docT.sure==2){
            document.body.docT.sure=0;
            //停用和启用的接口
            getAjaxResult("/orgInfo/saveOrgInfo","post",$("#fotTable")[0].jsonData,"stateFun(data)");
            closePopupWin();
        }
    }
    //删除确定的时候执行的函数
    function deleteSure(data){
        var jsData=JSON.parse(data);
        if(jsData.retCode=="0000000"){
            //location.reload();
            window.location.reload();
            $(".resourceAd-con-left ul").remove();
            getAjaxResult("/orgInfo/getChildTreeOrgInfo","POST",{"parentId":document.body.docT.orgId},"orgInfo(data)")
        }else{
            //alert(jsData.retDesc);
        }
    }
    //停用启用调用的接口
    function stateFun(data){
        var jsData=JSON.parse(data);
        if(jsData.retCode=="0000000"){

            getAjaxResult("/orgInfo/getOrgInfo","post",{"id":$("#fotTable")[0].jsonData.id},"initTissue(data)");
            //location.reload();
        }else{
            document.body.docT.alertBox.Alert(jsData.retDesc,"提示");
        }
    }
    $(document).ready(function () {
        limitCodeDeal($("*[limitCode]"),"limitCode");
        var docTiss=new tissueAdmin();
        docTiss.init();
        document.body.docT=docTiss;
    });
    //时间戳转换为时间的方法
    function fmtDate(obj){
        var date =  new Date(obj);
        var y = 1900+date.getYear();
        var m = "0"+(date.getMonth()+1);
        var d = "0"+date.getDate();
        return y+"-"+m.substring(m.length-2,m.length)+"-"+d.substring(d.length-2,d.length);
    }
    //树文字接口会掉函数
    function initTissue(data){
        var jsData=JSON.parse(data);
        if(jsData.retCode=="0000000"){
            if(jsData.rspBody.orgType){
                switch (jsData.rspBody.orgType) {
                    case "1":jsData.rspBody["orgTypeStr"]="销售公司";break;
                    case "2":jsData.rspBody["orgTypeStr"]="一级代理";break;
                    case "3":jsData.rspBody["orgTypeStr"]="贸易商";break;
                    case "4":jsData.rspBody["orgTypeStr"]="终端客户";break;
                    case "5":jsData.rspBody["orgTypeStr"]="酒钢机构";break;
                    default:jsData.rspBody["orgTypeStr"]="--";break;
                }
            }
            for(var key in jsData.rspBody){
                if(jsData.rspBody[key]){
                    jsData.rspBody['createdTime']=fmtDate(jsData.rspBody['createdTime'])
                    // 销售公司
                    // 一级代理
                    // 贸易商
                    // 终端客户


                    $("#fotTable #"+key).text(jsData.rspBody[key]);
                }
            }
            if(parseInt(jsData.rspBody.status)){
                $("#fotTable #statusText").text("启用");
                $("#fotTable #stateU").text("停用").attr("status","0")
            }else{
                $("#fotTable #statusText").text("未启用");
                $("#fotTable #stateU").text("启用").attr("status","1")
            }

            $("#fotTable")[0].jsonData=jsData.rspBody;
            $("#fotTable").css("display","block");
        }else{
            document.body.docT.alertBox.Alert(jsData.retDesc,"提示");
        }
    }
    //添加客户点击保存调用的接口
    function addReAFun(data) {
        var jsData=JSON.parse(data);
        if(jsData.retCode=="0000000"){
            //  location.reload();
            $(".resource").css("display","none")
            //编辑完刷新表格 1是编辑 0是新建
            closePopupWin();
            document.body.docT.alertBox.Alert("保存成功","提示")

            //alert("保存成功")
            if(document.body.docT.newCom){
                $(".resourceAd-con-left ul").remove();
                getAjaxResult("/orgInfo/getOrgInfo","post",{"id":$("#fotTable")[0].jsonData.id},"initTissue(data)");
                getAjaxResult("/orgInfo/getChildTreeOrgInfo","POST",{"parentId":document.body.docT.orgId},"orgInfo(data)");
            }else{
                /*document.body.docT.idC=jsData.rspBody;
                $(".resourceAd-con-left ul").remove();
                getAjaxResult("/orgInfo/getChildTreeOrgInfo","POST",{"parentId":document.body.docT.orgId},"orgInfo(data)");*/
                window.location.reload();

            }
            document.body.docT.newCom=null;


        }else{
            document.body.docT.newCom=null;
            closePopupWin();
            document.body.docT.alertBox.Alert(jsData.retDesc,"提示");
        }
    }
    //树的渲染
    function treeCheck(){
        this.data = {};
        this.isAllChecked = null;//该属性是否把子集全选
    }
    treeCheck.prototype.unionChecked = function(dom){
        $(dom).click(function(){

            for(var i=0;i<$(dom).length;i++){//后期优化
                // if(){
                // 	this.isAllChecked = false;//该属性是否把子集全选
                // }
            }
            //当选中或取消一个权限时，也同时选中或取消所有的下级权限
            $(this).siblings("ul").find("input").attr("checked",this.checked);

            //当选中一个权限时，也要选中所有的直接上级权限
            // if(this.checked ==true){
            //     $(this).parents("li").children("input").attr("checked",true);
            // }

            //当某一个父权限下的子权限都不选中时，该父权限也不选中
            var elements=$(this).parent("li").parent("ul").find("input");
            var num=elements.length;
            /*alert(num);*/
            var a=0;
            for(var i=0;i<num;i++){
                if(elements[i].checked==false){
                    a++;
                }
            }
            if(a==num){
                $(this).parent("li").parent("ul").siblings("input").attr("checked",false);
            }


        });
    }
    treeCheck.prototype.loopLoad = function(data, parentDom, bol){//递归,无限遍历下级dom树


        if(data){
            var oUl = document.createElement("ul");
            if( parentDom.attr("id") == "looptree"){
                oUl.id = "navigation";
                parentDom.append(oUl);
            }else{
                //if(!bol)oUl.style.display == "none";
                parentDom.append(oUl);
            }
            for(var i=0;i<data.length;i++){
                var oLi = document.createElement("li");
                var chk = "";
                if(data[i].isChecked){
                    chk = "checked";
                }
                oLi.innerHTML = "<div class='hitarea expandable-hitarea'></div><a href='javascript:;'>"+data[i].orgName+"</a>";
                oLi.data = data[i];
                if(data[i].lev == 1){
                    $("#navigation").append(oLi);
                }else{
                    $(oUl).append(oLi)
                }
                if(document.body.docT){
                    if(document.body.docT.idC){
                        if(data[i].id==document.body.docT.idC){
                            $(oLi).find("a").click();
                        }
                    }
                }
                if(data[i].children){
                    this.loopLoad(data[i].children, $(oLi), data[i].isChecked);
                }

            }
        }
    }
</script>
<span id="hiddenSpan" style="display:none">0,0,0</span>
<div class="resource" style="display:none">
    <div class="resource-div">
        <img src="../images/org_re.png"/>
        <span>
                暂无客户架构、
            </span>
        <span style="cursor: pointer">
                <span id="addTissue" style="color:#5accc6">添加</span>客户
            </span>
    </div>
</div>
<div class="resourceOrg" style="display:none">
    <div class="resource-div">
        <img src="../images/org_re.png"/>
        <span>
                    您没有权限查看客户
                </span>
    </div>
</div>
<div class="resourceAd" style="display:none">
    <div class="resourceAd-head" style="display: none">
        <input type="text" class="resourceAd-head-in"/>
        <a href="javascript:;" class="resourceAd-head-a">查询</a>
    </div>
    <div class="resourceAd-con">
        <div class="resourceAd-con-left">
            <div class="left-div">
                <span class="left-div-fir"><span class="fir-span">组织管理</span></span>
                <span class="left-div-two" style="cursor: pointer;display:none">根目录</span>
            </div>

        </div>
        <div class="resourceAd-con-right">
            <div class="right-head">
                <ul class="right-head-ul">
                    <li id="newTiss" limitCode="M50101"><i class="ul-iFir"></i><a href="javascript:;"  class="ul-fir" >新建</a></li>
                    <li id="comTiss" limitCode="M50102"><i class="ul-iTwo"></i><a href="javascript:;" class="ul-two">编辑</a></li>
                    <li id="deleteTiss" limitCode="M50103"><i class="ul-iThr"></i><a href="javascript:;" class="ul-tree">删除</a></li>
                </ul>
            </div>
            <div class="right-con">
                <!--<div class="right-con-div">-->
                <!--<a href="javascript:;" class="div-a-add" id="newTiss"><i class="add-i"></i><span>新建</span></a>-->
                <!--<a href="javascript:;" class="div-a-add" id="deleteTiss"><i class="add-i del-i"></i><span>删除</span></a>-->
                <!--<a href="javascript:;" class="div-a-add" id="comTiss"><i class="add-i com-i"></i><span>编辑</span></a>-->
                <!--</div>-->
                <!--<div class="right-con-tit">-->
                <!--<span>权限列表</span>-->
                <!--<span>权限操作</span>-->
                <!--</div>-->
                <div class="right-con-fot">
                    <!--<table style="display:none" id="fotTable">-->
                    <!--<thead>-->
                    <!--<tr>-->
                    <!--<th width="10%">id</th>-->
                    <!--<th width="15%">创建时间</th>-->
                    <!--<th width="15%">创建人</th>-->
                    <!--<th width="15%">名称</th>-->
                    <!--<th width="10%">状态</th>-->
                    <!--<th width="25%">备注</th>-->
                    <!--<th width="10%">操作</th>-->
                    <!--</tr>-->
                    <!--</thead>-->
                    <!--<tbody>-->
                    <!--<tr id="fotTable">-->
                    <!--<td id="id"></td>-->
                    <!--<td id="createdTime"></td>-->
                    <!--<td id="createdBy"></td>-->
                    <!--<td id="orgName"></td>-->
                    <!--<td id="statusText"></td>-->
                    <!--<td id="remark"></td>-->
                    <!--<td><a href="javascript:;" id="stateU"></a></td>-->
                    <!--</tr>-->
                    <!--</tbody>-->
                    <!--</table>-->
                    <ul id="fotTable" class="fot-ul" style="display:none">
                        <li  class="fot-ul-img"><img src="../images/roleP.png"/><span>客户管理</span></li>
                        <li><span>客户id：</span><span class="fot-ul-span" id="id"></span></li>
                        <li><span>客户编码：</span><span class="fot-ul-span" id="orgCode"></span></li>
                        <li><span>创建时间：</span><span class="fot-ul-span" id="createdTime"></span></li>
                        <li><span>创建人：</span><span class="fot-ul-span" id="createdBy"></span></li>
                        <li><span>客户名称：</span><span class="fot-ul-span" id="orgName"></span></li>
                        <li><span>sap编码：</span><span class="fot-ul-span" id="sapCode"></span></li>
                        <li><span>客户类型：</span><span class="fot-ul-span" id="orgTypeStr"></span></li>
                        <li><span>工商纳税识别号：</span><span class="fot-ul-span" id="bukrs"></span></li>
                        <li><span>电话：</span><span class="fot-ul-span" id="tel"></span></li>
                        <li><span>地址：</span><span class="fot-ul-span" id="addr"></span></li>
                        <li style="display:none"><span>客户状态：</span><span class="fot-ul-span" id="statusText"></span></li>
                        <li><span>备注：</span><span class="fot-ul-span" id="remark"></span></li>
                        <!--id 			客户id-->
                        <!--orgCode		客户code-->
                        <!--orgName		客户名称-->
                        <!--status			状态-->
                        <!--sapCode		sap-->
                        <!--orgType		客户类型-->
                        <!--tel 			电话-->
                        <!--addr			地址-->
                        <li style="display:none"><span>是否：</span><a href="javascript:;" id="stateU"></a></li>

                        <li limitCode="M50105"><span>查看角色：</span><a href="javascript:;" class="relevance" rel="2">查看角色</a></li>
                        <li><span>查看人员：</span><a href="javascript:;" class="viewUserMange">查看人员</a></li>
                        <!--<li><span>查看资源：</span><a href="javascript:;" class="relevance" rel="3">查看资源</a></li>-->
                        <!--<li class="font-ul-explain"><span class="explain-span">说明:</span><span></span></li>-->
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>
<div id="inputAnswer" class="popup gc_box" style="display:none">
    <div class="title" style="">
        <h2>新增组织</h2>
        <div>
            <a class="min" href="javascript:;" title="最小化" style="display:none;"></a>
            <a class="max" href="javascript:;" title="最大化" style="display:none;"></a>
            <a class="revert" href="javascript:;" title="还原" style="display:none;"></a>
            <a class="close" href="javascript:;" title="关闭" style="display:block;"></a>
        </div>
    </div>
    <div class="content">
        <div class="resourchSe" id="addReInpDiv">
            <ul class="resourchSe-ul">
                <li class="ml20"><label>sap编码：</label><input type="text" class="required" id="sapCode"/></li>
                <li class="ml20"><label>名称：</label><input type="text" class="required" id="addReInp" disabled="disabled"/></li>
                <li class="ml20"><label>客户类型：</label><select type="text" class="" id="orgType" selCode="orgTypeCode" selValue="orgTypeName" style="width:157px">
                    <option value="">请选择</option>
                    <option value="1">销售公司</option>
                    <option value="2">一级代理</option>
                    <option value="3">贸易商</option>
                    <option value="4">终端客户</option>
                    <option value="5">酒钢机构</option>
                </select></li>
                <li class="ml20"><label>工商纳税识别号：</label><input type="text" class="required isLengthOf numOrLetter" v_maxlength="18" v_minlength="18" isLengthOfmsg="请输入18位数字或英文"  placeholder="请输入18位数字或英文" id="bukrs"/></li>
                <li class="ml20"><label>电话：</label><input type="text" class="required newPhone" id="tel"/></li>
                <li class="ml20"><label>地址：</label><input type="text" class="required" id="addr"/></li>
                <li class="ml20"><label>备注：</label><textarea type="text" class="" id="memoInp"></textarea></li>
                <li class="ml20" limitCode="M50106"><input style="margin-right: 5px;margin-top: 9px;" type="checkbox" id="industrialCode"><label style="width: 140px">建材质证书可下载用户：</label></li>
                <!--<li class="ml20"><label>默认启用：</label><input type="checkbox" id="stateInp"/></li>-->
            </ul>
            <div class="mod-search-div" id="addRe" style="width:70px;height: 62px;margin:0 auto;">
                <a href="javascript:;" class="mod-searchBtn"><span>确定</span></a>
            </div>
        </div>
    </div>
</div>


</div>
</div>
<div style="width: 1200px;height: 70px;margin: 0px auto;text-align: center;line-height: 70px;">
    copyright ©️ 2018 甘肃酒钢集团宏兴钢铁股份有限公司 版权所有
</div>
</div>
</body>
</html>